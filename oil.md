# 石油製品

石油には以下のレシピがある

プラスチック生成:

* [0] Crude Oil 30000.00/min ==> Plastic 20.00/min Heavy Oil Residue 10000.00/min
* [1] Polymer Resin 60.00/min Water 20000.00/min ==> Plastic 20.00/min
* [2] Rubber 30.00/min Fuel 30000.00/min ==> Plastic 60.00/min

ゴム生成:

* [0] Crude Oil 30000.00/min ==> Rubber 20.00/min Heavy Oil Residue 20000.00/min
* [1] Polymer Resin 40.00/min Water 40000.00/min ==> Rubber 20.00/min
* [2] Plastic 30.00/min Fuel 30000.00/min ==> Rubber 60.00/min

燃料生成:

* [0] Crude Oil 60000.00/min ==> Fuel 40000.00/min Polymer Resin 30.00/min
* [1] Heavy Oil Residue 60000.00/min ==> Fuel 40000.00/min
* [2] Packaged Fuel 60.00/min ==> Fuel 60000.00/min Empty Canister 60.00/min
* [3] Heavy Oil Residue 50000.00/min Water 100000.00/min ==> Fuel 100000.00/min

重廃油生成:

* [0] Crude Oil 30000.00/min ==> Plastic 20.00/min Heavy Oil Residue 10000.00/min
* [1] Crude Oil 30000.00/min ==> Rubber 20.00/min Heavy Oil Residue 20000.00/min
* [2] Packaged Heavy Oil Residue 20.00/min ==> Heavy Oil Residue 20000.00/min Empty Canister 20.00/min
* [3] Crude Oil 60000.00/min ==> Polymer Resin 130.00/min Heavy Oil Residue 20000.00/min
* [4] Crude Oil 30000.00/min ==> Heavy Oil Residue 40000.00/min Polymer Resin 20.00/min

## やりたいこと

石油精製のラインは副産物が蜜に絡むので run.py のようなツリー型の生成工程では再現しづらいのと石油特化のテクが多いので石油に特化した生成工程を作成できるようにしたい。

CLI としては以下を引数に取り、graphviz で生産工程を可視化するものを想定する。

* プラ/ゴムの指定
* 原油に対する生産量 (生産レート3, 2, 1.3 が今のところあり得る)
* 目標の生産レート

ファイルは run.py とは分ける。`oil_plan.py` などがよいか

## ありうる工程

* 原油から3倍のプラ/ゴム生成
    * 重廃油からリサイクルプラゴムでループさせる (公式wikiに添付されている画像などを参照)
    * セットアップが面倒
    * リソースノードが枯渇してないなら過剰生産であることも多い
* vanilla recipe
    * 原油3 に対して プラ2あるいはゴム2しか生成できない (単純なので特にツールに組み込む必要はない)
* 1.3プラ / ゴム
    * vanilla で作ったあと、重廃油を希釈燃料にしてリサイクルプラゴムを適用
    * ループなしでまぁまぁお手軽
* 2ゴム
    * 1.3 プラと同じように vanilla で作ったあとにリサイクルプラゴムをするのだが、このステップを増やす
    * 具体的には原油3に対して以下のような感じ

```
原油3 → ゴム2＋重廃油2 → 燃料4

ここでゴムを 0.666 + 1.333 に分割して、
ゴム1.333 + 燃料1.333 → プラ2.666
プラ2.666 + 燃料2.666 → ゴム5.333
とするとゴム6ができる
```

## 疑問

* プラスチックについて2ゴムと同じような生産工程はできるのか？
    * プラゴム変換のステップをもう1回増やすか、重廃油の量を増やすかになるがあまり簡単にはいかない気がする
* 1.3プラの場合は重廃油が副産物として残ってしまうがどうにもならんかも
    * プラスチックをそこそこの生産量、かつ単純なステップ、副産物なしで生産する方法がなくてこまった
* 2ゴムにおいて途中のプラスチックの一部を生産物とすることで、一つのラインからプラとゴムを特定の比率で生産することは可能そうだが、どうやるといいだろうか？

## 考察メモ (2026-02-20)

リサイクル2レシピを連立で見ると整理しやすい。

前提（記号化）:

* リサイクルプラ: `ゴム + 燃料 -> 2プラ`
* リサイクルゴム: `プラ + 燃料 -> 2ゴム`
* 希釈燃料: `重廃油 -> 2燃料`
* 原油3からゴム開始: `原油3 -> ゴム2 + 重廃油2`

### 疑問1: 2ゴムの双対として2プラは可能か

可能。例えば原油3をゴム始動にして:

1. `原油3 -> ゴム2 + 重廃油2 -> 燃料4`
2. `ゴム2 + 燃料2 -> プラ4`
3. `プラ0.666 + 燃料0.666 -> ゴム1.333`
4. `ゴム1.333 + 燃料1.333 -> プラ2.666`

合計で `プラ6` となり、原油3に対して2.0相当（副産物なしで閉じる）。

### 疑問2: 1.3プラで重廃油が残る問題

閉ループのバランスを取れば、重廃油/燃料/中間ゴムは残さずに運用できる。
「1.3プラで副産物が残る」は、途中で止めたときの構成の問題であり、連立で閉じる構成にすれば解消可能。

### 疑問3: 2ゴムラインでプラも取り出して混載できるか

可能。2.0モードでは原油3あたりで `プラ + ゴム = 6` の範囲を連続的に取れる。
つまり目標比率 `P:R` が与えられたら:

* `プラ = 6 * P / (P + R)`
* `ゴム = 6 * R / (P + R)`

を満たすように取り出し量を設定できる。

## no-loop運用メモ

当面は混合比率を狙わず、単一製品で2.0を組む。

* ゴムのみ2.0:
  * `python oil_plan.py --mode=2.0 Rubber 300`
* プラのみ2.0:
  * `python oil_plan.py --mode=2.0 Plastic 300`
* ゴムのみ1.3:
  * `python oil_plan.py --mode=1.3 Rubber 300`
* プラのみ1.3:
  * `python oil_plan.py --mode=1.3 Plastic 300`

どちらも feed-forward（循環エッジなし）で可視化する。
希釈燃料を Packaged で回す場合は `--packaged` を付ける。
